# 更新日志

---

## v0.18 — 2026-02-14 7维度搜索 + 企业信息补全

### 三大改进

**1. 搜索维度 5→7**

新增两个独立搜索维度，解决 v0.17 与 Gemini Deep Research 对比中发现的覆盖性缺失：

| 新增维度 | 搜索内容 | 解决的问题 |
|---------|---------|----------|
| 📊 税收与财务 | 研发加计扣除200%、企业所得税15%、增值税即征即退 | v0.17完全没有税收搜索词 |
| 🏆 人才激励 | 重点产业人才奖励150万/人、高层次人才落户、科技成果转化奖励 | v0.17只搜"扩岗补助"，没搜个人激励 |

**2. Step 0 企业信息补全**

在搜政策之前，先用2次web search搜企业本身，补全企查查给不了的信息：
- 实际办公地址（可能≠注册地址）→ 同时搜两个区的政策
- 核心产品/技术路线 → 搜索词更精准
- 已获资质 → 知道搜"首次认定"还是"复审"
- 创始人背景 → 触发高层次人才政策

**3. 评分权重调整**

| 维度 | v0.17 权重 | v0.18 权重 | 原因 |
|------|-----------|-----------|------|
| ⏰ 紧迫性 | 15% | **25%** | 时效性是硬标准 |
| ✅ 可得性 | 20% | **10%** | 低可得性=改进建议方向，不应淘汰 |

### 涉及文件

| 文件 | 改动 |
|------|------|
| `prompts/expert_system_prompt.md` | 新增 §6 税收与财务 + §7 人才激励 |
| `policy_categories.py` | EXPERT_DIMENSIONS 5→7 |
| `orchestrator.py` | Step 0 补全 + 7维度plan/review + 评分权重调整 |
| `index.html` | 前端思考面板新增 Step 0 区块 + 7维度日志解析 |

---

## v0.17 — 2026-02-14 5维度政策评分体系

### 主要改进

从单一"相关度"评分升级为5维度加权评分体系，让用户一眼判断政策的申报价值。

### 5维度体系

| 维度 | 权重 | 核心问题 |
|------|------|---------|
| 💰 金额价值 | 30% | 能拿多少钱？S/A/B/C/D分级 |
| 🎯 独占性 | 25% | 竞争对手多不多？定制型→普惠型 |
| ✅ 可得性 | 20% | 当前能否满足申报条件？ |
| ⏰ 紧迫性 | 15% | 申报窗口还剩多久？过期=0分 |
| 🔄 持续性 | 10% | 一次性还是每年可申？ |

综合分 = 💰×0.3 + 🎯×0.25 + ✅×0.2 + ⏰×0.15 + 🔄×0.1

### 时效性硬规则

- 有效期已过 → ⏰=0，综合分上限35（解决v0.16过期政策仍得85分的问题）
- 申报已截止 → ⏰=0，综合分上限20
- 框架政策过期 → ⏰=10，综合分上限35

### 涉及文件

| 文件 | 改动类型 |
|------|---------|
| `models.py` | 新增6个评分字段 + amount_level |
| `orchestrator.py` | 打分prompt重写 + 结果解析 + 日志格式 |
| `server.py` | 日志写入5维度评分和理由 |
| `index.html` | 汇总表格展示5维度 + 金额等级 + 图例 |

---

## v0.16 — 2026-02-14 搜索时效性优化

### 主要问题

搜索结果中大量返回已过期的政策（如"十四五"时期 2021-2025 的政策），同时搜不到 2026 年的新政策。经过逐一访问政策原文验证，发现：

- 核心政策（集成电路专项、小微企业扶持等）全部于 2025-12-31 到期
- 年度申报通知的窗口也已关闭
- 甚至有 2014 年的政策、疫情临时政策等早已失效的内容
- AI 打分时不知道"今天是几号"，对过期政策仍给出 85-95 的高分

根本原因：整个搜索链路没有"时间意识"——搜索词不含年份、AI 不知当前日期、评审不看时效性。

### 修改内容

**1. 搜索词加年份（expert_system_prompt.md）**

新增 §2.5 时效性搜索规则，要求 AI 生成搜索词时包含当前年份（如"2026"）或"最新"、"十五五"等时间信号，优先搜有申报窗口的文件。

**2. 搜索结果提取有效期（web_search_worker.py）**

搜索 instructions 从静态字符串改为动态生成，注入当前日期。要求 AI 从原文中提取"有效期至"和"申报截止日期"。输出 JSON 新增 `validity` 和 `application_deadline` 字段。同时过滤已关闭的年度申报通知和未延续的疫情临时政策。

**3. 打分增加过期降分（orchestrator.py）**

打分 prompt 注入当前日期，新增时效性降分规则：
- 有效期已过 → 降至 30 分以下
- 申报窗口已关闭 → 降至 20 分以下
- 框架政策已过期 → 降至 35 分以下
- 发布超 3 年无"长期有效"标注 → 额外扣 20 分

**4. 回路评估增加时效性维度（orchestrator.py）**

评审 AI 现在能看到每条政策的日期和有效期，并新增"时效性评估"维度。如果发现大量结果过期，会自动在第二轮生成带年份的搜索词去找新政策。

**5. 时间预算增加（orchestrator.py + server.py）**

- 搜索总时间预算：180s → 360s（6 分钟）
- 最大搜索轮次：2 → 3
- 回路评审跳过阈值：30s → 45s
- Browse Use 阈值：60s → 90s

### 新增功能

- PolicyItem 新增 `application_deadline`（申报截止日期）字段
- 搜索阶段自动提取政策有效期和申报截止日期
- 回路评估输出新增 `timeliness` 时效性评分
- 打分日志显示有效期信息

### 涉及文件

| 文件 | 改动类型 |
|------|---------|
| `models.py` | 新增字段 |
| `web_search_worker.py` | instructions 动态化 + 解析新字段 |
| `prompts/expert_system_prompt.md` | 新增时效性搜索规则 |
| `orchestrator.py` | 打分动态化 + 回路评估时效性 + 时间预算 |
| `server.py` | 时间预算同步调整 |
