# 老姚的思考想法

## 1. 专家系统的持续学习与数据飞轮

未来专家系统需要建立一个**案例输入接口**，允许工作人员输入成功或失败的案例，形成数据飞轮，让系统越用越智能。

更好的方式是搭建一个简单的**申请 Track 系统**：

- 记录每一次申请的完整报告
- 追踪申请的过程与最终结果
- 基于真实反馈实现"持续学习"，不断优化专家系统的判断能力

> 核心理念：通过真实业务数据的不断积累与反馈闭环，驱动专家系统的迭代进化。

## 2. 政策沉淀与去重——构建自有政策数据文档库

对查找到的政策要反复沉淀、去重，形成我们自己的**政策数据文档库**。

- **节约成本**：避免对同一政策反复查找，减少重复的搜索和 AI 调用开销
- **赋能 AI 思考**：基于结构化的政策库，方便 AI 形成更多前沿视野的政策方向思考与跨领域关联分析

> 核心理念：把每一次搜索的成果都变成资产，越用越厚，让 AI 站在更高的知识基座上思考。

## 3. 建立 Evaluation 系统——全维度评估与闭环改进

建立全面的 **Evaluation 系统**，从多个维度对每次运行进行评估：

- **搜索过程评估**：追踪搜索策略、执行步骤、资源消耗等
- **搜索质量评估**：评估返回结果的相关性、完整性、准确性
- **业务结果评估**：最终产出是否解决了实际问题
- **建议价值评估**：给出的建议对决策的实际帮助程度

### 每次搜索自动打分

每次搜索完成后，系统应自动生成一份**搜索质量评分卡**，量化以下指标：

| 指标 | 评分方式 | 用途 |
|------|---------|------|
| **命中率** | 搜到的政策中有多少条能通过条件匹配 | 衡量搜索精准度 |
| **覆盖度** | 5维度×4层 = 20个格子覆盖了多少 | 衡量搜索广度 |
| **地域精准度** | 结果中本地政策占比 | 检测外省噪音 |
| **可申报比** | 可直接申报的政策 vs 宏观规划类文件 | 衡量实用性 |
| **稳定性** | 与上次同企业搜索结果的重叠度 | 衡量一致性 |
| **时效性** | 有效期内的政策占比 | 衡量结果新鲜度 |
| **Token 效率** | 政策数 / Token 消耗 | 衡量成本效率 |

### 持续优化闭环

- 每次搜索评分自动存入数据库，形成**趋势曲线**
- 评分低于阈值时，自动触发诊断：是搜索词问题、web search 返回质量问题、还是 AI 解析问题
- 定期出**优化建议报告**：哪些维度持续薄弱、哪些搜索词模板效果最好、哪些行业/地区需要定制规则

通过这些多维度的评估数据，形成闭环反馈机制，持续改进系统的各个环节。

> 核心理念：用数据说话，让每次运行都成为改进的燃料。

## 4. Orchestrator 规则体系的重构——从规则堆砌到评估驱动

Orchestrator 目前规则过多，后续需要重构为一套**基于评估驱动的调整体系**，而非简单的规则迭代。

- 不是无限地堆砌规则，而是通过评估数据来诊断问题根源
- 根据评估结果有针对性地调整，形成结构化的改进流程
- 让规则的增删改有明确的依据和效果反馈

> 核心理念：规则要少而精，决策要数据驱动。

## 5. Browser Use 的合理定位——深度搜索而非广度覆盖

Browser Use 目前还没有被调用过一次，后续需要明确其使用场景：

- **暂时不作为主要搜索工具**：不适合作为广度搜索引擎
- **按需激活**：需要登录认证的场景、或者系统自动执行查询时才启用
- **发挥优势**：更适合做深度搜索，处理复杂的交互式查询或需要逐步导航的场景

> 核心理念：恰当的工具用在恰当的场景，不是什么都用浏览器。

## 6. 政策有效期判定的优化——应对复杂的实际情况

目前的有效期判定存在问题，需要做更细致的分析：

- **区分政策类型**：是一次性政策还是 Recurring 类型反复执行的政策
- **诊断搜索问题**：为什么搜不到那些短期发布但仍在有效期内的文章
- **完善判定逻辑**：不能简单地根据时间戳判断，要考虑政策性质、更新频次等多个维度

> 核心理念：有效期判定要因地制宜，而不是一刀切。

## 7. 提高搜索稳定性——基础搜索固定 + AI 补充

当前最大问题不是质量不够，而是**不稳定**——同样的企业跑 5 次出 5 种不同结果。核心政策（如通信产业专项）时有时无。

**根因**：所有搜索词都由 AI 生成，AI 每次生成的搜索词不同，导致结果波动。

**解决方案：两层搜索架构**

- **基础层（固定）**：根据企业的行业+地区，用模板自动生成一组"必搜词"（如"浦东新区 光通信 产业扶持政策"、"上海 科技型企业 税收优惠"），不经过 AI，每次都搜，保证核心政策稳定命中。
- **补充层（AI 生成）**：AI 做特征工程后，只负责生成额外的补充搜索词（园区专项、身份属性、产业链细分等），用于拓展覆盖面。

**预期效果**：基础覆盖 100% 稳定，补充维度灵活可变，两者叠加后既稳又广。

> 核心理念：确定性的东西不要交给概率模型，AI 应该做增量而非替代。

## 8. 下一步核心功能——分析匹配 + 建议报告

当前系统做到了"搜到政策"，但搜到不等于可用。下一步要做的是**从搜索结果到可执行建议**的闭环：

### 第一阶段：政策-企业深度匹配

- **条件匹配**：把每条政策的申报条件（注册资本、员工人数、成立年限、行业范围、资质要求等）与企业工商数据逐项对比
- **差距诊断**：明确标出"已满足"、"不满足"、"信息不足无法判断"三种状态
- **匹配度分数**：不是现在的"AI 感觉像相关"，而是基于条件逐项核对后的**硬匹配分数**

### 第二阶段：建议报告生成

输出一份结构化的**企业政策匹配建议报告**，包含：

- **推荐申报清单**：按优先级排序，每条附带"为什么推荐"、"预计金额"、"申报窗口期"
- **差距补齐建议**：企业目前不满足某政策条件，给出"如何补齐"的路径（如"建议先申请科技型中小企业认定，再申报专精特新"）
- **时间线规划**：哪些政策现在可以申报、哪些需要等下一批次、哪些需要先做前置准备
- **风险提示**：有效期即将到期的政策、竞争激烈的项目、需要特别注意的合规要求

### 第三阶段：报告可视化与导出

- 在网页端展示可交互的建议报告
- 支持导出 PDF 供线下使用
- 可作为服务商给客户的交付物

> 核心理念：搜索只是手段，建议报告才是交付价值。从"信息搬运"升级到"决策辅助"。

---

## 🗺️ 执行优先级路线图

| 优先级 | 任务 | 依赖 | 预期价值 |
|--------|------|------|---------|
| **P0** | **接入企查查 API** — 用真实工商数据替换 Mock，获取完整字段（地址、经营范围、股东、知识产权、参保人数、风险信息） | 无 | 解锁专家系统全部 5 个维度分析能力 |
| **P0** | **搜索稳定性** — 固定基础搜索词模板 + AI 补充 | 无 | 消除结果波动，核心政策每次必中 |
| **P1** | **搜索评分系统** — 每次搜索自动打分（7 个指标），存库，出趋势曲线 | P0（需要真实数据作为评分基准） | 用数据驱动优化，替代人工判断 |
| **P1** | **政策沉淀去重** — 搜索结果入政策数据库，已有政策不重复搜 | P0 | 降低成本，加速搜索 |
| **P1** | **建议报告生成** — 推荐申报清单 + 差距补齐路径 + 时间线规划 | P0（需要企查查完整数据 + 稳定搜索结果） | 核心交付物，商业价值最高 |
| **P2** | **政策-企业深度匹配** — 条件逐项对比，硬匹配分数 | P0 + P1 | 从"相关"升级到"可申报" |
| **P2** | **Evaluation 闭环** — 低分自动诊断 + 定期优化建议报告 | P1（需要评分数据积累） | 系统自我进化 |
| **P2** | **报告可视化与 PDF 导出** | P1 报告生成 | 可作为服务商交付物 |
| **P3** | **案例 Track 系统** — 记录申请过程与结果，持续学习 | P1（需要有报告和申请流程） | 数据飞轮，长期壁垒 |
| **P3** | **Browser Use 深度搜索** — 对高价值政策做原文抓取、PDF 提取 | P2（需要匹配后筛选高价值目标） | 补充细节，提高报告质量 |
| **P3** | **Orchestrator 评估驱动重构** | P2 Evaluation 闭环 | 规则自动优化 |
## 9. 搜索引擎优化——时效性与过期政策问题

> 2026-02-14 诊断发现

### 问题：搜索结果大量返回已过期政策，且搜不到2026年新政策

通过阅读服务器搜索日志（`/opt/browser-sdk/search_logs/`）并**逐一访问政策原文链接验证**，发现系统性问题：

#### 问题一：搜索结果中大量政策已经过期

**原文验证结果**（当前日期 2026-02-14）：

| 政策 | 原文中的有效期条款 | 状态 |
|------|-------------------|------|
| 浦东新区促进重点优势产业高质量发展若干政策措施（浦府规〔2022〕5号） | "有效期至**2025年12月31日**" | ❌ 已过期 |
| 浦东新区"十四五"期间促进小微企业创新创业财政扶持办法（浦科经委规〔2022〕1号） | "有效期至**2025年12月31日**" | ❌ 已过期 |
| 浦东新区促进集成电路和新一代通信产业高质量发展专项操作细则（浦科经委规〔2024〕5号） | "有效期至**2025年12月31日**" | ❌ 已过期 |
| 2024年度小微企业创新创业财政扶持申报通知 | 申报截止 "**2024年9月8日24时**" | ❌ 已过期 |
| 2025年度集成电路和通信产业专项（第一批） | 申报截止 "**2025年3月28日16时**" | ❌ 已过期 |
| 2025年度工业通信业节能低碳专项 | 申报截止 "**2025年10月20日**" | ❌ 已过期 |
| 境内自然人在浦东新区投资设立中外合资经营企业管理办法 | "有效期**5年**"（2014年发布） | ❌ 过期7年 |
| 疫情影响企业职工线上职业培训补贴 | 原文链接返回 **404**，页面已下架 | ❌ 已失效 |

**核心发现**：不是个别政策过期，而是**"十四五"周期（2021-2025）已经整体结束**。搜索结果中得分最高的核心政策——集成电路和通信产业专项、小微企业创新创业扶持、重点优势产业政策——全部以 2025-12-31 为有效期截止。AI 打分时完全没有意识到这个问题，仍然给出 85-95 的高分。

#### 问题二：搜不到2026年新政策

从搜索日志看，系统生成的搜索词例如：
- "浦东新区 光通信专项资金"
- "浦东新区 小微企业 专项资金"
- "上海 光通信 强链补链"

**没有一个搜索词包含年份或时效性限定词**（如"2026"、"最新"、"十五五"）。

但2026年新政策确实存在！通过手动抓取上海市经信委网站，发现已有新政策陆续出台：

| 新政策 | 施行日期 | 有效期至 |
|--------|---------|---------|
| 上海市新材料中试基地和中试项目管理办法 | 2026-01-12 | 2031-01-11 |
| 上海市促进高成长企业加快发展管理实施细则 | 2025-12-22 | 2027-12-21 |
| 上海市重点产业领域人才专项奖励实施办法 | 2025-11-27 | 2027-11-26 |
| 上海市中小企业发展专项资金管理办法 | 2025-09-08 | 2027-09-07 |
| 上海市促进产业高质量发展专项资金管理办法 | 2025-04-27 | 2027-04-26 |

#### 搜不到新政策的5个根因

1. **搜索词不含时间限定**：提示词没有要求 AI 在搜索词中加入"2026"、"最新"、"十五五"等时间信号。搜索引擎默认返回 PageRank 最高的老页面。

2. **搜索引擎索引偏向老页面**："十四五"政策经过5年积累被大量引用，SEO权重极高；"十五五"政策刚发布，几乎没被引用，可能还没被搜索引擎收录。

3. **政策周期空窗期**：十四五结束（2025-12-31）→ 市级框架先出 → 区级细则后出 → 年度申报通知最后出。浦东新区的十五五细则可能尚在制定中。

4. **提示词没有"时效性意识"**：`expert_system_prompt.md` 整个认知框架没有任何关于政策时效性的指导，不要求搜当前年度政策，也不要求验证有效期。

5. **web_search_preview 没设时间过滤**：API 调用时没有设置时间范围参数，也没在 instructions 中注入当前日期。

### 改进计划

#### 改进一：搜索词加时间限定（改 expert_system_prompt.md）

在搜索策略部分增加规则：
- 每组搜索词至少有一个版本包含当前年份（如"2026"）或"最新"
- 对于周期性政策（十X五），同时搜"十五五"版本
- 示例：`浦东新区 2026 光通信 产业扶持政策`、`浦东新区 十五五 集成电路 专项`

#### 改进二：web_search 的 instructions 注入当前日期

将 `DEFAULT_POLICY_INSTRUCTIONS` 改为动态生成，注入当前日期：
> "当前日期为 {today}。请优先返回当前仍在有效期内的政策。已过期的年度申报通知不要返回。"

#### 改进三：打分 prompt 增加时效性降分规则（改 orchestrator.py SCORING_SYSTEM_PROMPT）

在打分规则中注入：
- 当前日期：`{current_date}`
- 申报窗口已关闭的年度性政策：直接降至 30 分以下
- 疫情专项等临时性政策（未明确延续）：降至 20 分以下
- 框架性文件已有具体年度申报通知时：降至 40 分以下
- 发布日期超3年且无"长期有效"标注：额外扣 20 分

#### 改进四：信用修复搜索的触发条件（改 expert_system_prompt.md）

仅在风险信息中**明确存在**失信/经营异常记录时，才生成信用修复搜索任务。如果风险信息为空或"无"，不浪费搜索配额。

#### 改进五：分两轮搜——先搜新政策，再搜长效政策

1. **第一轮（优先）**：搜"2026"/"最新"/"十五五" → 找新周期政策
2. **第二轮（补充）**：通用搜索 → 补充长期有效政策（如税收优惠）

#### 改进六：增强去重逻辑

当两条政策标题含相同政策名称但日期不同（如"2024年度"vs"2025年度"同一专项），只保留最新年度的。

> 核心理念：搜索的价值不在于搜到多少，而在于搜到的是否当前可用。时效性是政策搜索的生命线。

## 10. 政策评价标准——5维度加权评分体系（v0.17 实装）

> 2026-02-14 设计并实装

### 核心问题

v0.16 之前的评分只有一个维度（"相关度" 0-100），太粗糙。一条过期政策和一条正在申报的政策可能拿到相同的分数。需要多维度评价，让用户一眼看出"这条政策到底值不值得花精力去申报"。

### 5维度评分体系

| 维度 | 符号 | 权重 | 含义 | 核心问题 |
|------|------|------|------|---------|
| **金额价值** | 💰 score_amount | 30% | 企业能拿到多少钱 | "值多少？" |
| **独占性** | 🎯 score_exclusivity | 25% | 竞争对手多不多 | "只有我能申请吗？" |
| **可得性** | ✅ score_feasibility | 20% | 企业当前是否满足条件 | "我现在能申请吗？" |
| **紧迫性** | ⏰ score_urgency | 15% | 申报窗口还剩多久 | "还来得及吗？" |
| **持续性** | 🔄 score_sustainability | 10% | 一次性还是可反复获得 | "以后还能再拿吗？" |

**综合分 = 💰×0.3 + 🎯×0.25 + ✅×0.2 + ⏰×0.15 + 🔄×0.1**

### 维度一：💰 金额价值（score_amount）

| 等级 | 分数 | 金额范围 | 典型政策 |
|------|------|---------|---------|
| **S** | 100 | >500万 | 重大产业化项目、"一事一议"、市级重点专项 |
| **A** | 80 | 100-500万 | 通信产业专项、首台套、强链补链、高转项目 |
| **B** | 60 | 20-100万 | 高企认定奖励、专精特新资助、研发补贴 |
| **C** | 40 | 5-20万 | 创新券、扩岗补助、房租减免 |
| **D** | 20 | <5万或间接收益 | 荣誉称号、信用评级 |

**特殊规则**：
- 税收优惠需折算实际省税金额（如加计扣除200%，研发投入1000万×100%多扣×15%税率=150万，算A级）
- 门槛型政策按撬动价值评估（高企认定本身20万=C级，但它是3000万专项的前置条件，实际算A级）

### 维度二：🎯 独占性（score_exclusivity）

独占性 = **你能申请 + 竞争对手不能或懒得申请**

| 等级 | 分数 | 定义 | 判断方法 | 举例 |
|------|------|------|---------|------|
| **定制型** | 100 | 为特定企业量身定制 | 行业+地区+规模全匹配，符合者<50家 | 浦东新区光通信产业专项 |
| **行业型** | 80 | 行业门槛高 | 需特定资质/IP/产业链位置，同类<200家 | 5G-A/6G通信设备产业化 |
| **园区型** | 60 | 有一定筛选 | 需特定园区入驻或资质认定 | 张江高新区专项资金 |
| **地区型** | 40 | 地域限制 | 只需注册在特定区域 | 浦东新区中小微企业融资担保 |
| **普惠型** | 20 | 几乎无门槛 | 全市企业都能申请 | 扩岗补助（每人1500元） |

**判断子维度**：
- 行业精准度：`"光通信设备"` > `"新一代信息技术"` > `"制造业"` > `"中小企业"`
- 地域精准度：`"张江园区入驻企业"` > `"浦东新区"` > `"上海市"`
- 规模门槛：`100万注册资本即可` > `需营收>5000万`
- 资质门槛：`1件发明专利即可` > `需"国家级小巨人"认定`

### 维度三：✅ 可得性（score_feasibility）

| 分数 | 状态 | 判断标准 |
|------|------|---------|
| 100 | 全部满足 | 可直接申报 |
| 80 | 基本满足 | 缺1项非关键条件 |
| 60 | 大部分满足 | 缺1-2项可短期补齐的条件 |
| 40 | 缺关键条件 | 需6个月以上准备（如先拿高企认定） |
| 20 | 基本不满足 | 需企业根本性变化（如营收、规模） |

**核查清单**（与企查查数据逐项对比）：
- 注册资本：100万 vs 政策要求
- 成立年限：2023年成立（~2年） vs 政策要求
- 知识产权：1件发明专利（实审中） vs 政策要求
- 员工人数：12人 vs 政策要求
- 研发费用：未知 vs 政策要求
- 资质认定：尚未认定高企 vs 政策要求

### 维度四：⏰ 紧迫性（score_urgency）

| 分数 | 窗口状态 | 行动建议 |
|------|---------|---------|
| 100 | 截止<30天 | 🔴 立即准备材料 |
| 80 | 截止30-90天 | 🟡 启动准备 |
| 60 | 半年内或常年可申 | 🟢 纳入规划 |
| 40 | 预计下批次开放 | ⚪ 提前储备 |
| 20 | 窗口已关闭 | ⚫ 等下一年 |
| 0 | 有效期已过 | ❌ 无可操作性 |

**时效性硬规则**（覆盖其他维度）：
- 有效期已过 → score_urgency=0，综合分上限35
- 申报窗口已关闭 → score_urgency=0，综合分上限20
- 框架政策已过期（如"十四五"） → score_urgency=10，综合分上限35

### 维度五：🔄 持续性（score_sustainability）

| 分数 | 类型 | 说明 |
|------|------|------|
| 100 | 每年可申 | 创新券每年20万、年度研发补贴 |
| 80 | 周期性 | 十五五期间（2026-2030）可申报 |
| 60 | 一次性+门槛 | 金额不大但是其他大额政策的前置条件 |
| 40 | 纯一次性 | 高企首次认定奖励20万 |
| 20 | 一次性且小额 | 某项一次性补贴<5万 |

### 实装位置

| 文件 | 改动 |
|------|------|
| `models.py` | PolicyItem 新增 score_amount/score_exclusivity/score_feasibility/score_urgency/score_sustainability/score_reason/amount_level |
| `orchestrator.py` | 打分 prompt 重写为5维度体系，打分结果解析和日志输出更新 |
| `server.py` | 搜索日志记录完整5维度评分和理由 |
| `index.html` | 汇总表格展示5维度子分和金额等级 |

> 核心理念：评分不是一个数字能说清的。用户需要知道"这条政策值多少钱"（金额）、"我有没有优势"（独占性）、"我够格吗"（可得性）、"还来得及吗"（紧迫性）、"明年还能再申吗"（持续性）——五个维度缺一不可。